{% extends 'base.html' %}{% block head%}<link href="/static/css/magicsuggest.css" rel="stylesheet">{% endblock %}{% block customer %}class="active"{% endblock %}{% block customer_active %}in{% endblock %}{% block body %}<div class="row bg-box-shadow padding-10 panel panel-default">	<div class="panel-heading margin-5">        <h3 class="panel-title">客户检索</h3>        </div>    <form action="" class="form-inline" id="filter" method="post" enctype="multipart/form-data" data-ajax="false">		  {% csrf_token %}        <div class="row">        <div class="col-md-4 form-group">            <label class="altermargin col-md-4 row">名称: </label> <label><input class="form-control" type="text" name="name" {% if filter.name %} value="{{ filter.name }}"{%else%}value=""{% endif %}></label>            </div>        <div class="col-md-3 form-group">            <label>性别:<select name="sex">                <option value="">不限</option>                <option value="True" {% if filter.sex == True %} selected{% endif %}/>男</option>                <option value="False" {% if filter.sex == False %} selected{% endif %}/>女</option>            </select>            </label>            </div>        <div class="col-md-3 form-group">            <label>客户等级:{{ form.level }}</label>            </div>		<div class="form-group">            <label>公海:{{ form.usernull}}</label>        </div>		            </div>        <div class="row padding12">            <div class="col-md-4 form-group">                <label class="altermargin col-md-4 row">手机号码:</label>            <input class="form-control" name="phone_number" type="text" value='{{ filter.phone_number }}' style="width:200px;"/>        </div>            <div class="col-md-3 form-group">                <label>地址:</label>            <input class="form-control" name="address" type="text" value='{{ filter.address}}' style="width:200px;"/>        </div>		{% if user.is_superuser %}        <div class="col-md-4 form-group">            <label>所属客服:{{ form.user }}</label>            </div>            {% endif %}            </div>        <div class="row">		<div class="col-md-5 form-group" style="margin-left:7px;">            <label class="altermargin col-md-3 row">开始时间:</label>                <div class="input-group date form_date" data-date="" data-date-format="yyyy-mm-dd" data-link-field="dtp_input1">                    <input class="form-control width-105" size="16" name="starttime" type="text" value="{{filter.starttime}}" readonly style="width:105px">                    <!--<span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>-->					<span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>                </div>            <input type="hidden" id="dtp_input1" value="" />			<select class="add-house-option" name="start_hour">                {% for i in hour_list %}                <option value="{{i}}" {% if filter.starthour == i %} selected {% endif %}>{{i}}</option>                {% endfor %}			</select>时			<select class="add-min-option" name="start_minute">{% for i in minute_list %}                <option value="{{i}}" {% if filter.startminute == i %} selected {% endif %}>{{i}}</option>                {% endfor %}</select>分            </div>        <div class="col-md-5 form-group">            <label><label>结束时间:</label>                <div class="input-group date form_date" data-date="" data-date-format="yyyy-mm-dd" data-link-field="dtp_input2">                    <input class="form-control" size="16" name="endtime" type="text" value="{{ filter.endtime }}" readonly style="width:105px;">                    <!--<span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>-->					<span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>                </div>            <input type="hidden" id="dtp_input2" value="" />			<select class="add-house-option" name="end_hour">                {% for i in hour_list %}                <option value="{{i}}" {% if filter.endhour == i %} selected {% endif %}>{{i}}</option>                {% endfor %}            </select>时			<select class="add-min-option" name="end_minute">                {% for i in minute_list %}                <option value="{{i}}" {% if filter.endminute == i %} selected {% endif %}>{{i}}</option>                {% endfor %}            </select>分</label>            </div>    <div class="form-group">	    <button type="SUBMIT" class="btn btn-primary bottom-size">查询</button>        </div>            </div>    			</form>    </div><div class="row bg-box-shadow padding-5 table-responsive">        <table class="table table-bordered widthonly " id="table">        <thead>        <tr>            <th>姓名</th>            <th>性别</th>            <th>客户等级</th>            <th>所属客服</th>            <th>地址</th>            <th>手机号码</th>            <th>创建时间</th>            <th>操作</th>        </tr>        </thead>            {% for i in customer %}            <tr id="customer_{{i.id}}">            <td>                <a href="{% url 'get_customer_info' %}?customer_id={{i.id}}" data-toggle="modal" data-target="#get_customer_info">{{ i.name }}</a>            </td>            <td>{% if i.user %}                <a href="#" name="sex" class='{{ i.sex }}' data-type="select" data-pk="{{ i.id }}" data-title="性别">                   {% if i.sex %}男{% else %}女{% endif %}</a>                {% else %}{% if i.sex %}男{% else %}女{% endif %}{% endif %}            </td>            <td>{% if i.user %}<a href="#" name="level" data-type="select" data-pk="{{ i.id }}" data-title="等级">{{ i.level }}</a>            {% else %}{{ i.level }}{% endif %}</td>            <td>{{ i.user }}</td>            {% if i.get_contact_info %}                <td>{% if i.user %}                    <a href="#" name="address" data-type="text" data-pk="{{ i.id }}" data-title="输入地址">                    {{ i.get_contact_info.0.address }}</a>                {% else %}                {{ i.get_contact_info.0.address }}{% endif %}</td>                <td>{% if i.user %}<a href="#" name="phone_number" data-type="text" data-pk="{{ i.id }}" data-title="输入手机">                    {{ i.get_contact_info.0.phone_number }}</a>{% else %}{{ i.get_contact_info.0.phone_number }}{% endif %}                </td>            {% else %}                <td>无</td>                <td>无                </td>            {% endif %}                <td>{{ i.jointime|date:'Y-m-d h:i:s' }}</td>                <td>                {% if not user.is_superuser %}                <a href="{% url 'order_contact_add'%}?id={{i.id}}"><i class="glyphicon glyphicon-plus-sign"></i>添加联系方式</a>                    {% if not i.user %}                <a href="javascript:;" onclick= "owner_id('{{i.id}}')"><i class="glyphicon glyphicon-check"></i>归属到自己</a>                    {% else %}                <a href="{% url 'order_add'%}?customer_id={{i.id}}"><i class="glyphicon glyphicon-edit"></i>开单</a>                {% endif %}                {% endif %}                    <a href="javascript:;" onclick= "delete_id('{{i.id}}')" ><i class="glyphicon glyphicon-trash"></i>删除</a></td>            </tr>            {% endfor %}        </table>        {% if customer%}        <ul class="pagination" id="pagination"></ul>        {% endif %}    </div><div class="modal fade" id="get_customer_info" tabindex="-1" role="dialog"   aria-labelledby="myModalLabel" aria-hidden="true">   <div class="modal-dialog">      <div class="modal-content">          </div>       </div>    </div>{% endblock %}{% block js %}<script>    function delete_id(customer_id){        confirm_ = confirm('确定删除?');        if(confirm_){            $.ajax({                type:"GET",                url:'{% url 'order_customer_remove' %}?id='+customer_id,                success:function(msg){                    //alert("test order");                    //all delete is success,this can be execute                    //alert(msg)                    $("#customer_"+customer_id).remove();                }            });        }    };    function owner_id(customer_id){            $.ajax({                type:"GET",                url:'{% url 'order_customer_edit' %}?customer_id='+customer_id,                success:function(msg){                    alert('归属成功');                    $("#customer_"+customer_id).remove();                }        });        };</script><script type="text/javascript">$('body').on('hidden.bs.modal', '.modal', function () {$(this).removeData('bs.modal');});</script><script src="/static/js/jquery.twbsPagination.min.js"></script><script src="/static/js/magicsuggest.js"></script>	<!--<script type="text/javascript">$(function() {	$('#address').magicSuggest({		method:'get',        data:'{% url 'get_contact_address' %}',		valueField: 'address',        displayField: 'address'	});	$('#phone_number').magicSuggest({		method:'get',        data:'{% url 'get_contact_phone' %}',		valueField: 'phone_number',        displayField: 'phone_number'	});});</script>--><!--ajax——csrf验证--><script type="text/javascript">    function getCookie(name) {    var cookieValue = null;    if (document.cookie && document.cookie != '') {        var cookies = document.cookie.split(';');        for (var i = 0; i < cookies.length; i++) {            var cookie = jQuery.trim(cookies[i]);            // Does this cookie string begin with the name we want?            if (cookie.substring(0, name.length + 1) == (name + '=')) {                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));                break;            }        }    }    return cookieValue;}var csrftoken = getCookie('csrftoken');function csrfSafeMethod(method) {    // these HTTP methods do not require CSRF protection    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));}$.ajaxSetup({    beforeSend: function(xhr, settings) {        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {            xhr.setRequestHeader("X-CSRFToken", csrftoken);        }    }});</script>{% if customer %}<script type="text/javascript">$('#pagination').twbsPagination({        totalPages: {{ total_page }},		startPage:{{ current_page }},        visiblePages: {% if total_page > 4 %}5{% else %}{{ total_page }}{% endif %},        onPageClick: function (event, page) {            $.ajax({            type:"POST",            url:"{% url 'order_customer' %}",    data:{      name:$("[name='name']").val(),    sex:{% if filter.sex %}$("[name='sex']").val(){% else %}''{% endif %},    level:$("[name='level']").val(),    address:$("[name='address[]']").val(),    phone_number:$("[name='phone_number[]']").val(),    user:$("[name='user']").val(),    starttime:$("[name='starttime']").val(),    start_hour:$("[name='start_hour']").val(),    start_minute:$("[name='start_minute']").val(),    endtime:$("[name='endtime']").val(),    end_hour:$("[name='end_hour']").val(),    end_minute:$("[name='end_minute']").val(),	usernull:{% if filter.usernull %}'on'{% else %}''{% endif %},    page:page},    datatype:"html",    success:        function(data){        //$('#table').children().remove();        //$('#table').append(data)        //$('#table').empty().append(data)        $('#table').html(data)    }            })            }    });</script><!--分页--><script type="text/javascript">$(document).ready(function() {    //toggle `popup` / `inline` mode    $.fn.editable.defaults.mode = 'popup';    var name1=$("td [name='name']").attr("name");    $("td [name='name']").editable({    name:name1,    url:"{% url 'order_customer_edit' %}",	validate: function(value) {  if($.trim(value) == '')     return '输入的姓名不能为空';}    }    );    var sex1=$("td [name='sex']").attr("name");    var now_sex=$("td [name='sex']").attr("class")    $("td [name='sex']").editable({        value: now_sex,        name:sex1,        url:"{% url 'order_customer_edit' %}",        source: [              {value: 'True', text: '男'},              {value: 'False', text: '女'}           ]    });   var level=$("td [name='level']").attr("name");   var now_level=$("td [name='level']").val();    $("td [name='level']").editable({        value: now_level,        name:level,        url:"{% url 'order_customer_edit' %}",        source: [        {% for i in level %}              {value: '{{i}}', text: '{{i.name}}'},              {% endfor %}           ]    });    var address1=$("td [name='address']").attr("name");    $("td [name='address']").editable({    name:address1,    url:"{% url 'order_customer_edit' %}",	validate: function(value) {  if($.trim(value) == '')     return '输入的地址不能为空';}    }    );    var phone_number1=$("td [name='phone_number']").attr("name");    $("td [name='phone_number']").editable({    name:phone_number1,    url:"{% url 'order_customer_edit' %}",	validate: function(value) {  if($.trim(value).length>"15"||isNaN(value)||$.trim(value).length<"1")     return '请输入正确的手机号码';}    }    );});</script>{% endif %}{% endblock%}